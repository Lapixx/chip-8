<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CHIP-8</title>
    <script type="text/javascript" src="graphics.js"></script>
    <script type="text/javascript" src="audio.js"></script>
    <script type="text/javascript" src="index.js"></script>
  </head>
  <body>
    <canvas id="cvs"></canvas>
    <script type="text/javascript">
      const canvas = document.getElementById('cvs')
      const draw = initScreen(canvas)
      const buzz = initAudio()

      function loadGame(cb) {
        const fname = "./roms/pong"
        const xhr = new XMLHttpRequest
        xhr.open("GET", fname, true)
        xhr.responseType = "arraybuffer"
        xhr.onload = function () {
          if (xhr.status !== 200) {
            return cb(new Error(`Unable to load ROM. Status code ${xhr.status}`))
          }
          const rom = new Uint8Array(xhr.response)
          loadRom(rom)
          cb()
        }
        xhr.send()
      }

      loadGame(function (err) {
        if (err)
          throw err
        const loop = setInterval(() => {
          try { cycle(draw, buzz) }
          catch (err) {
            console.error(err)
            clearInterval(loop)
          }
        }, 60 / 1000)
      })
    </script>
  </body>
</html>
